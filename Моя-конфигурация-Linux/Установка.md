# Установка OpenSuse Tumbleweed

## Создание загрузочного USB накопителя

### Установка Live CD образа

```sh
wget https://download.opensuse.org/tumbleweed/iso/openSUSE-Tumbleweed-XFCE-Live-x86_64-Current.iso
```

!!!
Я буду ставить OpenSuse без установщика, то есть через консоль.
!!!

### Сжение(Burn) ISO образа

```sh
sudo dd bs=4M if=/path/to/iso of=/dev/sdX && sync
```

## Процесс установки

### Запуск Live CD

Как и с любой другой операционной системой или дистрибутивом Linux,
мы должны войти в загрузочный образ ISO.

После того как мы это сделаем перед нами появится XFCE рабочий стол.

![Запущенный Live CD](../uploads/opensuse_install_1.png)

После этого требуется лишь открыть браузер с этим руководством и терминал.

### (Опционально) Настройка SSH для доступа к системе

```sh
sudo passwd linux
sudo systemctl start sshd
```

Далее просто используем `ssh linux@x.x.x.x`.

### Подготовка разделов на жестком диске

Для начала требуется узнать наименование необходимого жесткого диска.
Делается это при помощи команды `lsblk`.

![Запуск команды lsblk](../uploads/opensuse_install_2.png)

Далее при помощи утилиты `fdisk` необходимо настроить разделы на данном диске.

```sh
sudo fdisk /dev/sda
# Для создания загрузочного раздела на 512Мб нажимаем следующую последовательность.
n > Enter > p > Enter > 1 > Enter > Enter > +512M > Enter  > t > Enter > 1 > EF > Enter
# Теперь надо создать swap раздел на 4Гб для поддержки гибернации.
n > Enter > p > Enter > 2 > Enter > Enter > +4GB > t > Enter > 2 > Enter > 82 > Enter
# И наконец мы создаем корневой раздел.
n > Enter > p > Enter > 3 > Enter > Enter > Enter
```

В конце проверяем что получилось используя `p`.

![Созданные разделы](../uploads/opensuse_install_3.png)

Если все выглядит хорошо, то используем `w`.

Теперь при помощи все той же команды `lsblk`,
мы можем увидеть, что разделы успешно создались.

![Разделы, которые видит система](../uploads/opensuse_install_4.png)

### Форматирование разделов

Для **/** разделов я буду использовать `ext4` файловую систему.

!!!
Вероятно позже добавлю настройку `xfs` и `btrfs`.
Крайне сомнительно, но может быть появится `bcachefs`.
!!!

```sh
sudo mkfs.vfat -L boot /dev/sda1
sudo mkfs.ext4 -L root /dev/sda3
sudo mkswap -L swap /dev/sda2
sudo swapon /dev/sda2
```

### Монтирование разделов

```sh
# Монтирование основных разделов
sudo mkdir -p /mnt/os
sudo mount /dev/sda3 /mnt/os
sudo mkdir -p /mnt/os/boot/efi
sudo mount /dev/sda1 /mnt/os/boot/efi

# Необходимый для операционной системы шлак
sudo mkdir /mnt/os/{proc,sys,dev,run}
sudo mount --types proc /proc /mnt/os/proc
sudo mount --rbind /sys /mnt/os/sys
sudo mount --make-rslave /mnt/os/sys
sudo mount --rbind /dev /mnt/os/dev
sudo mount --make-rslave /mnt/os/dev
sudo mount --bind /run /mnt/os/run
sudo mount --make-slave /mnt/os/run
```

### Установка базовой системы

```sh
sudo zypper --root /mnt/os ar --refresh https://download.opensuse.org/tumbleweed/repo/oss/ oss
sudo zypper --root /mnt/os in kernel-default grub2-efi zypper bash man vim shadow util-linux
sudo zypper --root /mnt/os in --no-recommends NetworkManager
```

### Chrooting

```sh
sudo chroot /mnt/os /bin/bash
source /etc/profile
export PS1="(chroot) ${PS1}"
```

### Настройка fstab

```sh
LABEL=efi    /boot/efi    vfat    defaults,noatime     0 2
LABEL=swap   none         swap    sw                   0 0
LABEL=root   /            ext4    noatime              0 1
```

### Установка grub

```sh
dracut -f
grub2-install /dev/sda
grub2-mkconfig > /boot/efi/grub2/grub.cfg
passwd
```

### Загрузка в систему

```sh
exit
umount -l /mnt/os/dev/{/shm,/pts,}
umount -R /mnt/os
reboot
sudo systemctl enable --now NetworkManager
```
